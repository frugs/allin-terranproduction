<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="style.css">

  <title>Blah</title>
  <meta name="description" content="Queen Inject Efficiency Plotter">
  <meta name="author" content="frugs">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
  <script src="https://unpkg.com/pako@1.0.5/dist/pako_inflate.min.js"></script>
</head>

<body>

  <div class="primary-element">
    <span id="playerName"></span>
  </div>

  <div class="chart-container">
    <canvas id="myChart" width="800" height="600"></canvas>
  </div>

  <script type="text/javascript">
    queryParams = window.location.search
    nextParamIndex = queryParams.indexOf('&')
    dataParamValue = nextParamIndex != -1 ? queryParams.substring(6, nextParamIndex) : queryParams.substring(6)

    compressedAndEncodedJsonData = decodeURIComponent(dataParamValue)
    compressedJsonData = atob(compressedAndEncodedJsonData)
    decompressedJsonData = pako.inflate(compressedJsonData, {to: "string"})
    jsonData = decodeURIComponent(escape(decompressedJsonData))

    rawInputData = JSON.parse(jsonData)

    for (var i = 0, len = rawInputData.players.length; i < len; i++) {
      player = rawInputData.players[i]

      document.getElementById("playerName").innerHTML = player.name

      colours = [
        "#39A2AE",
        "#498467",
        "#9B8816",
        "#503D3F",
        "#C1D37F",
        "#181F1C",
        "#EC0B43",
        "#EDCB96"
      ]

      chartData = {
         datasets: player.chartData.map((data, index) => {

           isUsage = index % 2 == 0
           colour = isUsage ? "#39A2AE" : "#498467"

           return {
             label: "",
             data: data,
             steppedLine: 'before',
             fill: false,
             backgroundColor: colour,
             pointRadius: 0,
             borderColor: colour,
             borderWidth: isUsage ? 3 : 1
           }
         })
      }

      var ctx = document.getElementById("myChart").getContext('2d');
      var myChart = new Chart(ctx, {
          type: 'line',
          data: chartData,
          options: {
            title: {
              display: true,
              text: "Production Efficiency",
              fontSize: 36
            },
            scales: {
              xAxes: [{
                  type: 'time',
                  position: 'bottom',
                  time: {
                    unit: 'minute',
                    displayFormats: {
                        minute: 'mm:ss'
                    }
                  }
                }],
                yAxes: [{
                    display: false,
                    ticks: {
                      suggestedMin: -1,
                      beginAtZero: false
                    }
                }]
            },
            legend: {
              display: false
            },
            tooltip: {
              enabled: false
            },
            layout: {
              padding: 20
            },
            animation: {
              easing: 'easeOutCubic'
            }
          }
      });

      break
    }

  </script>
</body>
</html>
